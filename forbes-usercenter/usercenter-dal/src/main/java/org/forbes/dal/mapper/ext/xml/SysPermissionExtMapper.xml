<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.forbes.dal.mapper.ext.SysPermissionExtMapper" >
  <resultMap id="BaseResultMap" type="org.forbes.dal.entity.SysPermission" extends="org.forbes.dal.mapper.SysPermissionMapper.BaseResultMap">
  </resultMap>
  <sql id="Base_Column_List" >
   <include refid="org.forbes.dal.mapper.SysPermissionMapper.Base_Column_List" />
  </sql>
    <!--通过权限id查询权限内容-->
    <select id="getPermissionById" resultType="org.forbes.comm.vo.PermissionVo">
        SELECT
        id,
        parent_id,
        name,
        perms,
        icon,
        is_route,
        is_leaf,
        is_hidden,
        sort_no,
        description
        redirect,
        url,
        type
        FROM f_sys_permission
        WHERE id=#{id}
    </select>
    <!--查询所有权限-->
    <select id="getPermission" resultType="org.forbes.comm.vo.PermissionVo">
        SELECT
         id,
        parent_id,
        name,
        perms,
        icon,
        is_route,
        is_leaf,
        is_hidden,
        sort_no,
        description
        redirect,
        url,
        type
        type
        FROM f_sys_permission
    </select>
    <!--添加一个新的权限(仅添加权限)-->
    <insert id="addPermission" parameterType="org.forbes.dal.entity.SysPermission">
        INSERT INTO f_sys_permission
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="parentId != null">
                parent_id,
            </if>
            <if test="name != null">
                name,
            </if>
            <if test="perms != null">
                perms,
            </if>
            <if test="component != null">
                component,
            </if>
            <if test="componentName != null">
                component_name,
            </if>
            <if test="isRoute != null">
                is_route,
            </if>
            <if test="isLeaf != null">
                is_ieaf,
            </if>
            <if test="isHidden != null">
                is_hidden,
            </if>
            <if test="sortNo != null">
                sort_no,
            </if>
            <if test="description != null">
                description,
            </if>
            <if test="redirect != null">
                redirect,
            </if>
            <if test="url != null">
                url,
            </if>
            <if test="icon != null">
                icon,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="parentId != null">
                #{parentId},
            </if>
            <if test="name != null">
                #{name},
            </if>
            <if test="perms != null">
                #{perms},
            </if>
            <if test="component != null">
                #{component},
            </if>
            <if test="componentName != null">
                #{componentName},
            </if>
            <if test="isRoute != null">
                #{isRoute},
            </if>
            <if test="isLeaf != null">
                #{isLeaf},
            </if>
            <if test="isHidden != null">
                #{isHidden},
            </if>
            <if test="sortNo != null">
                #{sortNo},
            </if>
            <if test="description != null">
                #{description},
            </if>
            <if test="redirect != null">
                #{redirect},
            </if>
            <if test="url != null">
                #{url},
            </if>
            <if test="icon != null">
                #{icon},
            </if>
        </trim>
    </insert>

    <!--修改权限内容-->
    <update id="updatePermission" parameterType="org.forbes.comm.dto.UpdatePermissionDto">
      UPDATE f_sys_permission SET
        <set>
            <if test="parentId != null">
                parent_id = #{parentId},
            </if>
            <if test="name != null">
                name = #{name},
            </if>
            <if test="perms != null">
                perms = #{perms},
            </if>
            <if test="component != null">
                component = #{component},
            </if>
            <if test="componentName != null">
                component_name = #{componentName},
            </if>
            <if test="isRoute != null">
                is_route = #{isRoute},
            </if>
            <if test="isLeaf != null">
                is_ieaf = #{isLeaf},
            </if>
            <if test="isHidden != null">
                is_hidden = #{isHidden},
            </if>
            <if test="sortNo != null">
                sort_no = #{sortNo},
            </if>
            <if test="description != null">
                description = #{description},
            </if>
            <if test="redirect != null">
                redirect = #{redirect},
            </if>
            <if test="url != null">
                url = #{url},
            </if>
            <if test="icon != null">
                icon = #{icon},
            </if>
        </set>
      WHERE id = #{id}
    </update>
    <!--删除一个权限-->
    <delete id="deletePermission">
        DELETE FROM f_sys_permission
        WHERE id = #{id,jdbcType=BIGINT}
    </delete>
    <!--批量删除权限-->
    <delete id="deletePermissions" parameterType="java.util.List">
        DELETE FROM f_sys_permission
        WHERE id IN
        <foreach collection="ids" item="item" separator="," open="(" close=")" index="">
        #{item}
        </foreach>
    </delete>

    <!--根据权限id查询该权限在中间表是否存在-->
    <select id="selectPermissionId" parameterType="Long" resultType="Integer">
        SELECT COUNT(permission_id) FROM f_sys_role_permission WHERE permission_id =#{permissionId}
    </select>

    <!--根据权限id查询该权限在中间表是否存在-->
    <select id="selectPermissionIds" parameterType="java.util.List" resultType="Integer">
        SELECT COUNT(permission_id) FROM f_sys_role_permission WHERE permission_id IN
        <foreach collection="ids" item="item" separator="," open="(" close=")" index="">
            #{item}
        </foreach>
    </select>
</mapper>